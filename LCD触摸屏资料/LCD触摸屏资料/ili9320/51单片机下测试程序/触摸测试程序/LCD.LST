C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN LCD.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE LCD.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          #include <reg51.h>
   2          #include <intrins.h>
   3          
   4          
   5          #define Bus_16        //16位数据模式,如果使用8位模式，请注释此语句，如果使用16位模式，请打开此句
   6          #define  LCD_DataPortH P2     //高8位数据口,8位模式下只使用高8位 
   7          #define  LCD_DataPortL P0     //低8位数据口     ,8位模式下低8位可以不接线,请确认P0口已经上拉10K电阻,不宜太小，
             -最小4.7K,推荐10K.
   8          sbit LCD_RS = P3^5;              //数据/命令切换
   9          sbit LCD_WR = P3^6;               //写控制
  10          sbit LCD_RD =P3^7;                   //读控制
  11          sbit LCD_CS=P1^0;               //片选  
  12          sbit LCD_REST = P1^2;         //复位  
  13          
  14          /* touch panel interface define */
  15          sbit DCLK          =    P1^7;   
  16          sbit CS        =    P1^4;
  17          sbit DIN       =    P3^0;       
  18          sbit DOUT      =    P3^1;                                                                                                                                                                                  
  19          sbit Penirq       =    P3^4;   //检测触摸屏响应信号
  20            
  21          struct pix_
  22          {
  23                  unsigned int x;
  24                  unsigned int y;
  25          };
  26          struct pix_ Tp_pix;      //当前触控坐标的取样值  
  27          
  28          unsigned char code close[]={
  29          /*--  文字:  X  --*/
  30          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  31          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  32          0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x50,0x50,0xD8,0x00,0x00,
  33          };
  34          //8*12字符
  35          unsigned char code zifu[]={         
  36          /*--  文字:     --*/
  37          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  38          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  39          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  40          
  41          /*--  文字:  !  --*/
  42          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  43          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  44          0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x20,0x00,0x00,
  45          
  46          /*--  文字:  "  --*/
  47          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  48          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  49          0x00,0x28,0x50,0x50,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  50          
  51          /*--  文字:  #  --*/
  52          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  53          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  54          0x00,0x00,0x28,0x28,0xFC,0x28,0x50,0xFC,0x50,0x50,0x00,0x00,
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 2   

  55          
  56          /*--  文字:  $  --*/
  57          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  58          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  59          0x00,0x20,0x78,0xA8,0xA0,0x60,0x30,0x28,0xA8,0xF0,0x20,0x00,
  60          
  61          /*--  文字:  %  --*/
  62          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  63          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  64          0x00,0x00,0x48,0xA8,0xB0,0x50,0x28,0x34,0x54,0x48,0x00,0x00,
  65          
  66          /*--  文字:  &  --*/
  67          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  68          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  69          0x00,0x00,0x20,0x50,0x50,0x78,0xA8,0xA8,0x90,0x6C,0x00,0x00,
  70          
  71          /*--  文字:  '  --*/
  72          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  73          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  74          0x00,0x40,0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  75          
  76          /*--  文字:  (  --*/
  77          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  78          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  79          0x00,0x04,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x08,0x04,0x00,
  80          
  81          /*--  文字:  )  --*/
  82          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  83          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  84          0x00,0x40,0x20,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x40,0x00,
  85          
  86          /*--  文字:  *  --*/
  87          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  88          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  89          0x00,0x00,0x00,0x20,0xA8,0x70,0x70,0xA8,0x20,0x00,0x00,0x00,
  90          
  91          /*--  文字:  +  --*/
  92          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  93          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  94          0x00,0x00,0x20,0x20,0x20,0xF8,0x20,0x20,0x20,0x00,0x00,0x00,
  95          
  96          /*--  文字:  ,  --*/
  97          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
  98          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
  99          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x40,0x80,
 100          
 101          /*--  文字:  -  --*/
 102          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 103          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 104          0x00,0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,
 105          
 106          /*--  文字:  .  --*/
 107          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 108          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 109          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,
 110          
 111          /*--  文字:  /  --*/
 112          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 113          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 114          0x00,0x08,0x10,0x10,0x10,0x20,0x20,0x40,0x40,0x40,0x80,0x00,
 115          
 116          /*--  文字:  0  --*/
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 3   

 117          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 118          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 119          0x00,0x00,0x70,0x88,0x88,0x88,0x88,0x88,0x88,0x70,0x00,0x00,
 120          
 121          /*--  文字:  1  --*/
 122          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 123          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 124          0x00,0x00,0x20,0x60,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00,
 125          
 126          /*--  文字:  2  --*/
 127          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 128          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 129          0x00,0x00,0x70,0x88,0x88,0x10,0x20,0x40,0x80,0xF8,0x00,0x00,
 130          
 131          /*--  文字:  3  --*/
 132          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 133          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 134          0x00,0x00,0x70,0x88,0x08,0x30,0x08,0x08,0x88,0x70,0x00,0x00,
 135          
 136          /*--  文字:  4  --*/
 137          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 138          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 139          0x00,0x00,0x10,0x30,0x50,0x50,0x90,0x78,0x10,0x18,0x00,0x00,
 140          
 141          /*--  文字:  5  --*/
 142          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 143          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 144          0x00,0x00,0xF8,0x80,0x80,0xF0,0x08,0x08,0x88,0x70,0x00,0x00,
 145          
 146          /*--  文字:  6  --*/
 147          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 148          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 149          0x00,0x00,0x70,0x90,0x80,0xF0,0x88,0x88,0x88,0x70,0x00,0x00,
 150          
 151          /*--  文字:  7  --*/
 152          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 153          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 154          0x00,0x00,0xF8,0x90,0x10,0x20,0x20,0x20,0x20,0x20,0x00,0x00,
 155          
 156          /*--  文字:  8  --*/
 157          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 158          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 159          0x00,0x00,0x70,0x88,0x88,0x70,0x88,0x88,0x88,0x70,0x00,0x00,
 160          
 161          /*--  文字:  9  --*/
 162          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 163          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 164          0x00,0x00,0x70,0x88,0x88,0x88,0x78,0x08,0x48,0x70,0x00,0x00,
 165          
 166          /*--  文字:  :  --*/
 167          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 168          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 169          0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x20,0x00,0x00,
 170          
 171          /*--  文字:  ;  --*/
 172          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 173          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 174          0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x20,0x20,0x00,
 175          
 176          /*--  文字:  <  --*/
 177          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 178          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 4   

 179          0x00,0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x00,0x00,
 180          
 181          /*--  文字:  =  --*/
 182          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 183          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 184          0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,
 185          
 186          /*--  文字:  >  --*/
 187          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 188          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 189          0x00,0x40,0x20,0x10,0x08,0x04,0x08,0x10,0x20,0x40,0x00,0x00,
 190          
 191          /*--  文字:  ?  --*/
 192          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 193          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 194          0x00,0x00,0x70,0x88,0x88,0x10,0x20,0x20,0x00,0x20,0x00,0x00,
 195          
 196          /*--  文字:  @  --*/
 197          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 198          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 199          0x00,0x00,0x70,0x88,0x98,0xA8,0xA8,0xB8,0x80,0x78,0x00,0x00,
 200          
 201          /*--  文字:  A  --*/
 202          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 203          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 204          0x00,0x00,0x20,0x20,0x30,0x50,0x50,0x78,0x48,0xCC,0x00,0x00,
 205          
 206          /*--  文字:  B  --*/
 207          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 208          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 209          0x00,0x00,0xF0,0x48,0x48,0x70,0x48,0x48,0x48,0xF0,0x00,0x00,
 210          
 211          /*--  文字:  C  --*/
 212          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 213          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 214          0x00,0x00,0x78,0x88,0x80,0x80,0x80,0x80,0x88,0x70,0x00,0x00,
 215          
 216          /*--  文字:  D  --*/
 217          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 218          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 219          0x00,0x00,0xF0,0x48,0x48,0x48,0x48,0x48,0x48,0xF0,0x00,0x00,
 220          
 221          /*--  文字:  E  --*/
 222          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 223          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 224          0x00,0x00,0xF8,0x48,0x50,0x70,0x50,0x40,0x48,0xF8,0x00,0x00,
 225          
 226          /*--  文字:  F  --*/
 227          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 228          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 229          0x00,0x00,0xF8,0x48,0x50,0x70,0x50,0x40,0x40,0xE0,0x00,0x00,
 230          
 231          /*--  文字:  G  --*/
 232          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 233          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 234          0x00,0x00,0x38,0x48,0x80,0x80,0x9C,0x88,0x48,0x30,0x00,0x00,
 235          
 236          /*--  文字:  H  --*/
 237          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 238          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 239          0x00,0x00,0xCC,0x48,0x48,0x78,0x48,0x48,0x48,0xCC,0x00,0x00,
 240          
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 5   

 241          /*--  文字:  I  --*/
 242          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 243          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 244          0x00,0x00,0xF8,0x20,0x20,0x20,0x20,0x20,0x20,0xF8,0x00,0x00,
 245          
 246          /*--  文字:  J  --*/
 247          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 248          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 249          0x00,0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x90,0xE0,0x00,
 250          
 251          /*--  文字:  K  --*/
 252          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 253          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 254          0x00,0x00,0xEC,0x48,0x50,0x60,0x50,0x50,0x48,0xEC,0x00,0x00,
 255          
 256          /*--  文字:  L  --*/
 257          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 258          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 259          0x00,0x00,0xE0,0x40,0x40,0x40,0x40,0x40,0x44,0xFC,0x00,0x00,
 260          
 261          /*--  文字:  M  --*/
 262          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 263          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 264          0x00,0x00,0xD8,0xD8,0xD8,0xD8,0xA8,0xA8,0xA8,0xA8,0x00,0x00,
 265          
 266          /*--  文字:  N  --*/
 267          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 268          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 269          0x00,0x00,0xDC,0x48,0x68,0x68,0x58,0x58,0x48,0xE8,0x00,0x00,
 270          
 271          /*--  文字:  O  --*/
 272          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 273          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 274          0x00,0x00,0x70,0x88,0x88,0x88,0x88,0x88,0x88,0x70,0x00,0x00,
 275          
 276          /*--  文字:  P  --*/
 277          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 278          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 279          0x00,0x00,0xF0,0x48,0x48,0x70,0x40,0x40,0x40,0xE0,0x00,0x00,
 280          
 281          /*--  文字:  Q  --*/
 282          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 283          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 284          0x00,0x00,0x70,0x88,0x88,0x88,0x88,0xE8,0x98,0x70,0x18,0x00,
 285          
 286          /*--  文字:  R  --*/
 287          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 288          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 289          0x00,0x00,0xF0,0x48,0x48,0x70,0x50,0x48,0x48,0xEC,0x00,0x00,
 290          
 291          /*--  文字:  S  --*/
 292          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 293          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 294          0x00,0x00,0x78,0x88,0x80,0x60,0x10,0x08,0x88,0xF0,0x00,0x00,
 295          
 296          /*--  文字:  T  --*/
 297          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 298          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 299          0x00,0x00,0xF8,0xA8,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00,
 300          
 301          /*--  文字:  U  --*/
 302          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 6   

 303          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 304          0x00,0x00,0xCC,0x48,0x48,0x48,0x48,0x48,0x48,0x30,0x00,0x00,
 305          
 306          /*--  文字:  V  --*/
 307          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 308          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 309          0x00,0x00,0xCC,0x48,0x48,0x50,0x50,0x30,0x20,0x20,0x00,0x00,
 310          
 311          /*--  文字:  W  --*/
 312          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 313          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 314          0x00,0x00,0xA8,0xA8,0xA8,0x70,0x50,0x50,0x50,0x50,0x00,0x00,
 315          
 316          /*--  文字:  X  --*/
 317          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 318          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 319          0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x50,0x50,0xD8,0x00,0x00,
 320          
 321          /*--  文字:  Y  --*/
 322          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 323          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 324          0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x20,0x20,0x70,0x00,0x00,
 325          
 326          /*--  文字:  Z  --*/
 327          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 328          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 329          0x00,0x00,0xF8,0x90,0x10,0x20,0x20,0x40,0x48,0xF8,0x00,0x00,
 330          
 331          /*--  文字:  [  --*/
 332          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 333          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 334          0x00,0x38,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x38,0x00,
 335          
 336          /*--  文字:  \  --*/
 337          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 338          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 339          0x00,0x40,0x40,0x40,0x20,0x20,0x10,0x10,0x10,0x08,0x00,0x00,
 340          
 341          /*--  文字:  ]  --*/
 342          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 343          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 344          0x00,0x70,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x70,0x00,
 345          
 346          /*--  文字:  ^  --*/
 347          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 348          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 349          0x00,0x20,0x50,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 350          
 351          /*--  文字:  _  --*/
 352          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 353          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 354          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,
 355          
 356          /*--  文字:  `  --*/
 357          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 358          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 359          0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 360          
 361          /*--  文字:  a  --*/
 362          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 363          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 364          0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x38,0x48,0x3C,0x00,0x00,
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 7   

 365          
 366          /*--  文字:  b  --*/
 367          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 368          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 369          0x00,0x00,0xC0,0x40,0x40,0x70,0x48,0x48,0x48,0x70,0x00,0x00,
 370          
 371          /*--  文字:  c  --*/
 372          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 373          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 374          0x00,0x00,0x00,0x00,0x00,0x38,0x48,0x40,0x40,0x38,0x00,0x00,
 375          
 376          /*--  文字:  d  --*/
 377          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 378          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 379          0x00,0x00,0x18,0x08,0x08,0x38,0x48,0x48,0x48,0x3C,0x00,0x00,
 380          
 381          /*--  文字:  e  --*/
 382          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 383          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 384          0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x78,0x40,0x38,0x00,0x00,
 385          
 386          /*--  文字:  f  --*/
 387          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 388          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 389          0x00,0x00,0x1C,0x20,0x20,0x78,0x20,0x20,0x20,0x78,0x00,0x00,
 390          
 391          /*--  文字:  g  --*/
 392          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 393          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 394          0x00,0x00,0x00,0x00,0x00,0x3C,0x48,0x30,0x40,0x78,0x44,0x38,
 395          
 396          /*--  文字:  h  --*/
 397          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 398          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 399          0x00,0x00,0xC0,0x40,0x40,0x70,0x48,0x48,0x48,0xEC,0x00,0x00,
 400          
 401          /*--  文字:  i  --*/
 402          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 403          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 404          0x00,0x00,0x20,0x00,0x00,0x60,0x20,0x20,0x20,0x70,0x00,0x00,
 405          
 406          /*--  文字:  j  --*/
 407          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 408          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 409          0x00,0x00,0x10,0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0xE0,
 410          
 411          /*--  文字:  k  --*/
 412          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 413          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 414          0x00,0x00,0xC0,0x40,0x40,0x5C,0x50,0x70,0x48,0xEC,0x00,0x00,
 415          
 416          /*--  文字:  l  --*/
 417          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 418          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 419          0x00,0x00,0xE0,0x20,0x20,0x20,0x20,0x20,0x20,0xF8,0x00,0x00,
 420          
 421          /*--  文字:  m  --*/
 422          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 423          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 424          0x00,0x00,0x00,0x00,0x00,0xF0,0xA8,0xA8,0xA8,0xA8,0x00,0x00,
 425          
 426          /*--  文字:  n  --*/
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 8   

 427          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 428          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 429          0x00,0x00,0x00,0x00,0x00,0xF0,0x48,0x48,0x48,0xEC,0x00,0x00,
 430          
 431          /*--  文字:  o  --*/
 432          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 433          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 434          0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x48,0x48,0x30,0x00,0x00,
 435          
 436          /*--  文字:  p  --*/
 437          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 438          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 439          0x00,0x00,0x00,0x00,0x00,0xF0,0x48,0x48,0x48,0x70,0x40,0xE0,
 440          
 441          /*--  文字:  q  --*/
 442          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 443          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 444          0x00,0x00,0x00,0x00,0x00,0x38,0x48,0x48,0x48,0x38,0x08,0x1C,
 445          
 446          /*--  文字:  r  --*/
 447          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 448          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 449          0x00,0x00,0x00,0x00,0x00,0xD8,0x60,0x40,0x40,0xE0,0x00,0x00,
 450          
 451          /*--  文字:  s  --*/
 452          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 453          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 454          0x00,0x00,0x00,0x00,0x00,0x78,0x40,0x30,0x08,0x78,0x00,0x00,
 455          
 456          /*--  文字:  t  --*/
 457          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 458          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 459          0x00,0x00,0x00,0x20,0x20,0x70,0x20,0x20,0x20,0x18,0x00,0x00,
 460          
 461          /*--  文字:  u  --*/
 462          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 463          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 464          0x00,0x00,0x00,0x00,0x00,0xD8,0x48,0x48,0x48,0x3C,0x00,0x00,
 465          
 466          /*--  文字:  v  --*/
 467          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 468          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 469          0x00,0x00,0x00,0x00,0x00,0xEC,0x48,0x50,0x30,0x20,0x00,0x00,
 470          
 471          /*--  文字:  w  --*/
 472          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 473          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 474          0x00,0x00,0x00,0x00,0x00,0xA8,0xA8,0x70,0x50,0x50,0x00,0x00,
 475          
 476          /*--  文字:  x  --*/
 477          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 478          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 479          0x00,0x00,0x00,0x00,0x00,0xD8,0x50,0x20,0x50,0xD8,0x00,0x00,
 480          
 481          /*--  文字:  y  --*/
 482          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 483          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 484          0x00,0x00,0x00,0x00,0x00,0xEC,0x48,0x50,0x30,0x20,0x20,0xC0,
 485          
 486          /*--  文字:  z  --*/
 487          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 488          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 9   

 489          0x00,0x00,0x00,0x00,0x00,0x78,0x10,0x20,0x20,0x78,0x00,0x00,
 490          
 491          /*--  文字:  {  --*/
 492          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 493          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 494          0x00,0x18,0x10,0x10,0x10,0x20,0x10,0x10,0x10,0x10,0x18,0x00,
 495          
 496          /*--  文字:  |  --*/
 497          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 498          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 499          0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,
 500          
 501          /*--  文字:  }  --*/
 502          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 503          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 504          0x00,0x60,0x20,0x20,0x20,0x10,0x20,0x20,0x20,0x20,0x60,0x00,
 505          
 506          /*--  文字:  ~  --*/
 507          /*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
 508          /*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
 509          0x40,0xA4,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 510          
 511              
 512          };  
 513          
 514          //**********************************************************
 515          void spistar()                                     //SPI开始
 516          {
 517   1      CS=1;
 518   1      DCLK=1;
 519   1      DIN=1;
 520   1      DCLK=1;
 521   1      }
 522          //**********************************************************
 523          void WriteCharTo7843(unsigned char num)          //SPI写数据
 524          {
 525   1      unsigned char count=0;
 526   1      DCLK=0;
 527   1      for(count=0;count<8;count++)
 528   1      {
 529   2      num<<=1;
 530   2      DIN=CY;
 531   2      DCLK=0; _nop_();_nop_();_nop_();                //上升沿有效
 532   2      DCLK=1; _nop_();_nop_();_nop_();
 533   2      }
 534   1      }
 535          //**********************************************************
 536          unsigned int ReadFromCharFrom7843()             //SPI 读数据
 537          {
 538   1      unsigned char count=0;
 539   1      unsigned int Num=0;
 540   1      for(count=0;count<12;count++)
 541   1      {
 542   2      Num<<=1;
 543   2      DCLK=1; _nop_();_nop_();_nop_();                //下降沿有效
 544   2      DCLK=0; _nop_();_nop_();_nop_();
 545   2      if(DOUT) Num++;
 546   2      }
 547   1      return(Num);
 548   1      }       
 549          void delayms(int count)  // /* X1ms */
 550          {
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 10  

 551   1              int i,j;
 552   1              for(i=0;i<count;i++)
 553   1                      for(j=0;j<1000;j++);
 554   1      }
 555          
 556          #ifdef  Bus_16    //条件编译-16位数据模式   
 557          void LCD_Writ_Bus(char VH,char VL)   //并行数据写入函数
 558          {
 559   1          LCD_DataPortH=VH;   
 560   1              LCD_DataPortL=VL;               
 561   1              LCD_WR=0;
 562   1              LCD_WR=1; 
 563   1      }
 564          #else                   //条件编译-8位数据模式 
              void LCD_Writ_Bus(char VH,char VL)   //并行数据写入函数
              {       
                  LCD_DataPortH=VH;   
                      LCD_WR=0;
                      LCD_WR=1;
                      LCD_DataPortH=VL;               
                      LCD_WR=0;
                      LCD_WR=1;
              }
              #endif
 575          
 576          void Lcd_Write_Com(char VH,char VL)      //发送命令-8位参数
 577          {       
 578   1          LCD_RS=0;
 579   1              LCD_Writ_Bus(VH,VL);
 580   1      }
 581          void Lcd_Write_Data(char VH,char VL) //发送数据-8位参数
 582          {
 583   1          LCD_RS=1;
 584   1              LCD_Writ_Bus(VH,VL);
 585   1      }
 586          void Lcd_Write_Com_Data(int com,int val)                   //发送数据命令
 587          {
 588   1              Lcd_Write_Com(com>>8,com);
 589   1          Lcd_Write_Data(val>>8,val);
 590   1      }
 591          
 592          void Address_set(unsigned int x1,unsigned int y1,unsigned int x2,unsigned int y2)
 593          {
 594   1              Lcd_Write_Com(0x00,0x20);Lcd_Write_Data(x1>>8,x1);        //设置X坐标位置
 595   1          Lcd_Write_Com(0x00,0x21);Lcd_Write_Data(y1>>8,y1);   //设置Y坐标位置
 596   1          Lcd_Write_Com(0x00,0x50);Lcd_Write_Data(x1>>8,x1);   //开始X
 597   1              Lcd_Write_Com(0x00,0x52);Lcd_Write_Data(y1>>8,y1);        //开始Y
 598   1          Lcd_Write_Com(0x00,0x51);Lcd_Write_Data(x2>>8,x2);   //结束X
 599   1              Lcd_Write_Com(0x00,0x53);Lcd_Write_Data(y2>>8,y2);   //结束Y
 600   1          Lcd_Write_Com(0x00,0x22);                                                    
 601   1      }
 602          void Lcd_Init(void)
 603          {
 604   1      
 605   1          LCD_REST=1;
 606   1          delayms(5); 
 607   1              LCD_REST=0;
 608   1              delayms(5);
 609   1              LCD_REST=1;
 610   1              LCD_CS=1;
 611   1              LCD_RD=1;
 612   1              LCD_WR=1;
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 11  

 613   1              delayms(5);
 614   1              
 615   1      
 616   1              LCD_CS =0;  //打开片选使能
 617   1              //************* Start Initial Sequence **********//
 618   1      
 619   1       Lcd_Write_Com_Data(0x00e5, 0x8000);    
 620   1                      Lcd_Write_Com_Data(0x0000, 0x0001);     
 621   1                      Lcd_Write_Com_Data(0x0001, 0x0100);
 622   1                      Lcd_Write_Com_Data(0x0002, 0x0700);
 623   1                      Lcd_Write_Com_Data(0x0003, 0x1030);
 624   1                      Lcd_Write_Com_Data(0x0004, 0x0000);
 625   1                      Lcd_Write_Com_Data(0x0008, 0x0202);     
 626   1                      Lcd_Write_Com_Data(0x0009, 0x0000);     
 627   1                      Lcd_Write_Com_Data(0x000A, 0x0000);
 628   1                      Lcd_Write_Com_Data(0x000C, 0x0000);     
 629   1                      Lcd_Write_Com_Data(0x000D, 0x0000);     
 630   1                      Lcd_Write_Com_Data(0x000F, 0x0000);     
 631   1              //-----Power On sequence----------------------- 
 632   1                      Lcd_Write_Com_Data(0x0010, 0x0000);     
 633   1                      Lcd_Write_Com_Data(0x0011, 0x0007);     
 634   1                      Lcd_Write_Com_Data(0x0012, 0x0000);     
 635   1                      Lcd_Write_Com_Data(0x0013, 0x0000);     
 636   1                      delayms(150);
 637   1                      Lcd_Write_Com_Data(0x0010, 0x17B0);     
 638   1                      Lcd_Write_Com_Data(0x0011, 0x0007);     
 639   1                      delayms(50);
 640   1                      Lcd_Write_Com_Data(0x0012, 0x013A);     
 641   1                      delayms(50);
 642   1                      Lcd_Write_Com_Data(0x0013, 0x1A00);     
 643   1                      Lcd_Write_Com_Data(0x0029, 0x000c);             
 644   1                      delayms(50);
 645   1              //-----Gamma control-----------------------     
 646   1                      Lcd_Write_Com_Data(0x0030, 0x0000);     
 647   1                      Lcd_Write_Com_Data(0x0031, 0x0505);     
 648   1                      Lcd_Write_Com_Data(0x0032, 0x0004);     
 649   1                      Lcd_Write_Com_Data(0x0035, 0x0006);     
 650   1                      Lcd_Write_Com_Data(0x0036, 0x0707);     
 651   1                      Lcd_Write_Com_Data(0x0037, 0x0105);     
 652   1                      Lcd_Write_Com_Data(0x0038, 0x0002);     
 653   1                      Lcd_Write_Com_Data(0x0039, 0x0707);     
 654   1                      Lcd_Write_Com_Data(0x003C, 0x0704);     
 655   1                      Lcd_Write_Com_Data(0x003D, 0x0807);     
 656   1              //-----Set RAM area-----------------------      
 657   1                      Lcd_Write_Com_Data(0x0050, 0x0000);
 658   1                      Lcd_Write_Com_Data(0x0051, 0x00EF);
 659   1                      Lcd_Write_Com_Data(0x0052, 0x0000);
 660   1                      Lcd_Write_Com_Data(0x0053, 0x013F);
 661   1                      Lcd_Write_Com_Data(0x0060, 0x2700);
 662   1                      Lcd_Write_Com_Data(0x0061, 0x0001);
 663   1                      Lcd_Write_Com_Data(0x006A, 0x0000);
 664   1                      Lcd_Write_Com_Data(0x0021, 0x0000);     
 665   1                      Lcd_Write_Com_Data(0x0020, 0x0000);     
 666   1              //-----Partial Display Control------------      
 667   1                      Lcd_Write_Com_Data(0x0080, 0x0000);     
 668   1                      Lcd_Write_Com_Data(0x0081, 0x0000);
 669   1                      Lcd_Write_Com_Data(0x0082, 0x0000);
 670   1                      Lcd_Write_Com_Data(0x0083, 0x0000);
 671   1                      Lcd_Write_Com_Data(0x0084, 0x0000);     
 672   1                      Lcd_Write_Com_Data(0x0085, 0x0000);
 673   1              //-----Panel Control----------------------
 674   1                      Lcd_Write_Com_Data(0x0090, 0x0010);     
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 12  

 675   1                      Lcd_Write_Com_Data(0x0092, 0x0000);
 676   1                      Lcd_Write_Com_Data(0x0093, 0x0003);
 677   1                      Lcd_Write_Com_Data(0x0095, 0x0110);
 678   1                      Lcd_Write_Com_Data(0x0097, 0x0000);     
 679   1                      Lcd_Write_Com_Data(0x0098, 0x0000);
 680   1              //-----Display on-----------------------        
 681   1                      Lcd_Write_Com_Data(0x0007, 0x0173);     
 682   1                      delayms(50);
 683   1      
 684   1              LCD_CS =1;  //关闭片选使能
 685   1      
 686   1      }                
 687          void Pant(char VH,char VL)
 688          {
 689   1              int i,j;
 690   1              LCD_CS =0;  //打开片选使能
 691   1              Address_set(0,0,239,319);
 692   1          for(i=0;i<320;i++)
 693   1               {
 694   2                for (j=0;j<240;j++)
 695   2                      {
 696   3                       Lcd_Write_Data(VH,VL);
 697   3                  }
 698   2      
 699   2                }
 700   1           LCD_CS =1;  //关闭片选使能
 701   1      }
 702          void inttostr(int dd,unsigned char *str)
 703          {
 704   1              str[0]=dd/10000+48;
 705   1              str[1]=(dd/1000)-((dd/10000)*10)+48;
 706   1              str[2]=(dd/100)-((dd/1000)*10)+48;
 707   1              str[3]=(dd/10)-((dd/100)*10)+48;
 708   1              str[4]=dd-((dd/10)*10)+48;
 709   1              str[5]=0;
 710   1      } 
 711          unsigned char Makpix(struct pix_ pix1,struct pix_ pix2)
 712          {
 713   1      unsigned char l=0;
 714   1      int x=pix1.x>pix2.x?pix1.x-pix2.x:pix2.x-pix1.x;
 715   1      int y=pix1.y>pix2.y?pix1.y-pix2.y:pix2.y-pix1.y;
 716   1      if(x<14&&y<11)   //软件滤波，2次取样的值相差太大的视为噪声
 717   1      {
 718   2              l=1;
 719   2              Tp_pix.x=pix1.x;
 720   2              Tp_pix.y=pix1.y;
 721   2      }
 722   1      return l;
 723   1      }
 724          struct pix_ AD7843()            
 725          {
 726   1      //delayms(1);                     //中断后延时以消除抖动，使得采样数据更准确
 727   1      //spistar();                       //启动SPI
 728   1      //while(BUSY);                //如果BUSY信号不好使可以删除不用
 729   1      //delayms(1);
 730   1      struct pix_ pix;
 731   1      CS=0;
 732   1      WriteCharTo7843(0x90);        //送控制字 10010000 即用差分方式读X坐标 详细请见有关资料
 733   1      //while(BUSY);               //如果BUSY信号不好使可以删除不用
 734   1      //delayms(1);
 735   1      DCLK=1; _nop_();_nop_();_nop_();_nop_();
 736   1      DCLK=0; _nop_();_nop_();_nop_();_nop_();
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 13  

 737   1      pix.y=ReadFromCharFrom7843();
 738   1      WriteCharTo7843(0xD0);       //送控制字 11010000 即用差分方式读Y坐标 详细请见有关资料
 739   1      DCLK=1; _nop_();_nop_();_nop_();_nop_();
 740   1      DCLK=0; _nop_();_nop_();_nop_();_nop_();
 741   1      pix.x=ReadFromCharFrom7843();
 742   1      CS=1; 
 743   1      return pix;
 744   1      }
 745          unsigned char Getpix() //取采样值，此处使用软件滤波，2次取样的值相差太大的视为噪声
 746          {
 747   1              struct pix_ pix1;
 748   1              struct pix_ pix2; 
 749   1              pix1=AD7843();
 750   1              pix2=AD7843();
 751   1              return  Makpix(pix1,pix2);      
 752   1      }
 753          
 754          //在指定位置显示一个字符(8*12大小)
 755          //dcolor为内容颜色，gbcolor为背静颜色
 756          void showzifu(unsigned int x,unsigned int y,unsigned char value,unsigned int dcolor,unsigned int bgcolor)       
 757          {  
 758   1              unsigned char i,j;
 759   1              unsigned char *temp=zifu;    
 760   1          Address_set(x,y,x+7,y+11); //设置区域      
 761   1              temp+=(value-32)*12;
 762   1              for(j=0;j<12;j++)
 763   1              {
 764   2                      for(i=0;i<8;i++)
 765   2                      {                    
 766   3                              if((*temp&(1<<(7-i)))!=0)
 767   3                              {
 768   4                                      Lcd_Write_Data(dcolor>>8,dcolor);
 769   4                              } 
 770   3                              else
 771   3                              {
 772   4                                      Lcd_Write_Data(bgcolor>>8,bgcolor);
 773   4                              }   
 774   3                      }
 775   2                      temp++;
 776   2               }
 777   1      }
 778          
 779          //在指定位置显示一个字符串(8*12大小)
 780          //dcolor为内容颜色，gbcolor为背静颜色
 781          void showzifustr(unsigned int x,unsigned int y,unsigned char *str,unsigned int dcolor,unsigned int bgcolor
             -)          
 782          {  
 783   1              unsigned int x1,y1;
 784   1              x1=x;
 785   1              y1=y;
 786   1              while(*str!='\0')
 787   1              {       
 788   2                      showzifu(x1,y1,*str,dcolor,bgcolor);
 789   2                      x1+=7;
 790   2                      str++;
 791   2              }       
 792   1      }
 793          
 794          main()
 795          {
 796   1              unsigned char ss[6];    
 797   1              unsigned int lx,ly;     
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 14  

 798   1              spistar();  //模拟spi初始化
 799   1              Lcd_Init();   //tft初始化
 800   1              Pant(0xff,0xff);        //清屏                                  
 801   1              LCD_CS =0;  //打开LCD片选使能
 802   1          showzifustr(68,5,"GOOD",0,0xffff);  //显示字符串   
 803   1              while(1)
 804   1              {       
 805   2                      if (Penirq==0)
 806   2                      {               
 807   3                              if(Getpix()==1) //得到当前TP的取样值，此处使用软件滤波，2次取样的值相差太大的视为噪声
 808   3                              {
 809   4                                      inttostr(Tp_pix.x,ss);
 810   4                                      showzifustr(10,305,"X:",0xf800,0xffff);
 811   4                                      showzifustr(25,305,ss,0xf800,0xffff);   //显示字符串 
 812   4                                      inttostr(Tp_pix.y,ss);
 813   4                                      showzifustr(80,305,"Y:",0xf800,0xffff);
 814   4                                      showzifustr(95,305,ss,0xf800,0xffff);   //显示字符串 
 815   4                                      lx=240-((Tp_pix.x-320)*10/146);
 816   4                                      ly=320-((Tp_pix.y-380)/11);
 817   4                                      Address_set(lx,ly,lx+2,ly+2);
 818   4                                      Lcd_Write_Data(0,255);
 819   4                                      Lcd_Write_Data(0,255);
 820   4                                      Lcd_Write_Data(0,255);
 821   4                                      Lcd_Write_Data(0,255);
 822   4                                      Lcd_Write_Data(0,255);
 823   4                                      Lcd_Write_Data(0,255);
 824   4                                      Lcd_Write_Data(0,255);
 825   4                                      Lcd_Write_Data(0,255);
 826   4                                      Lcd_Write_Data(0,255);
 827   4                              }
 828   3                      //      delayms(100);
 829   3      
 830   3                      }
 831   2                      else
 832   2                      {
 833   3      
 834   3                      }
 835   2      
 836   2          }
 837   1      
 838   1      
 839   1      
 840   1      }
 841          
 842          
 843          
 844          
 845          
 846          
 847          
 848          
 849          
 850          
 851          
 852          
 853          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1701    ----
   CONSTANT SIZE    =   1163    ----
   XDATA SIZE       =   ----    ----
C51 COMPILER V7.06   LCD                                                                   11/11/2011 23:26:36 PAGE 15  

   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4      73
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
