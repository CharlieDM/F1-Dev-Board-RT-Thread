#include <reg51.h>
#include <intrins.h>


#define Bus_16        //16位数据模式,如果使用8位模式，请注释此语句，如果使用16位模式，请打开此句
#define  LCD_DataPortH P2     //高8位数据口,8位模式下只使用高8位 
#define  LCD_DataPortL P0     //低8位数据口	,8位模式下低8位可以不接线,请确认P0口已经上拉10K电阻,不宜太小，最小4.7K,推荐10K.
sbit LCD_RS = P3^5;  		 //数据/命令切换
sbit LCD_WR = P3^6;		  //写控制
sbit LCD_RD =P3^7;		     //读控制
sbit LCD_CS=P1^0;		//片选	
sbit LCD_REST = P1^2;	      //复位  

/* touch panel interface define */
sbit DCLK	   =    P1^7;   
sbit CS        =    P1^4;
sbit DIN       =    P3^0;	
sbit DOUT      =    P3^1;																						   
sbit Penirq       =    P3^4;   //检测触摸屏响应信号
  
struct pix_
{
	unsigned int x;
	unsigned int y;
};
struct pix_ Tp_pix;	 //当前触控坐标的取样值  

unsigned char code close[]={
/*--  文字:  X  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x50,0x50,0xD8,0x00,0x00,
};
//8*12字符
unsigned char code zifu[]={         
/*--  文字:     --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  !  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x20,0x00,0x00,

/*--  文字:  "  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x28,0x50,0x50,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  #  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x28,0x28,0xFC,0x28,0x50,0xFC,0x50,0x50,0x00,0x00,

/*--  文字:  $  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x20,0x78,0xA8,0xA0,0x60,0x30,0x28,0xA8,0xF0,0x20,0x00,

/*--  文字:  %  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x48,0xA8,0xB0,0x50,0x28,0x34,0x54,0x48,0x00,0x00,

/*--  文字:  &  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x50,0x50,0x78,0xA8,0xA8,0x90,0x6C,0x00,0x00,

/*--  文字:  '  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x40,0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  (  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x04,0x08,0x10,0x10,0x10,0x10,0x10,0x10,0x08,0x04,0x00,

/*--  文字:  )  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x40,0x20,0x10,0x10,0x10,0x10,0x10,0x10,0x20,0x40,0x00,

/*--  文字:  *  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x20,0xA8,0x70,0x70,0xA8,0x20,0x00,0x00,0x00,

/*--  文字:  +  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x20,0x20,0xF8,0x20,0x20,0x20,0x00,0x00,0x00,

/*--  文字:  ,  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x40,0x80,

/*--  文字:  -  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  .  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,

/*--  文字:  /  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x08,0x10,0x10,0x10,0x20,0x20,0x40,0x40,0x40,0x80,0x00,

/*--  文字:  0  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x88,0x88,0x88,0x88,0x70,0x00,0x00,

/*--  文字:  1  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x60,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00,

/*--  文字:  2  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x10,0x20,0x40,0x80,0xF8,0x00,0x00,

/*--  文字:  3  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x08,0x30,0x08,0x08,0x88,0x70,0x00,0x00,

/*--  文字:  4  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x10,0x30,0x50,0x50,0x90,0x78,0x10,0x18,0x00,0x00,

/*--  文字:  5  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x80,0x80,0xF0,0x08,0x08,0x88,0x70,0x00,0x00,

/*--  文字:  6  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x90,0x80,0xF0,0x88,0x88,0x88,0x70,0x00,0x00,

/*--  文字:  7  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x90,0x10,0x20,0x20,0x20,0x20,0x20,0x00,0x00,

/*--  文字:  8  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x70,0x88,0x88,0x88,0x70,0x00,0x00,

/*--  文字:  9  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x88,0x78,0x08,0x48,0x70,0x00,0x00,

/*--  文字:  :  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00,0x20,0x00,0x00,

/*--  文字:  ;  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x20,0x20,0x00,

/*--  文字:  <  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x00,0x00,

/*--  文字:  =  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,

/*--  文字:  >  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x40,0x20,0x10,0x08,0x04,0x08,0x10,0x20,0x40,0x00,0x00,

/*--  文字:  ?  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x10,0x20,0x20,0x00,0x20,0x00,0x00,

/*--  文字:  @  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x98,0xA8,0xA8,0xB8,0x80,0x78,0x00,0x00,

/*--  文字:  A  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x20,0x30,0x50,0x50,0x78,0x48,0xCC,0x00,0x00,

/*--  文字:  B  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF0,0x48,0x48,0x70,0x48,0x48,0x48,0xF0,0x00,0x00,

/*--  文字:  C  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x78,0x88,0x80,0x80,0x80,0x80,0x88,0x70,0x00,0x00,

/*--  文字:  D  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF0,0x48,0x48,0x48,0x48,0x48,0x48,0xF0,0x00,0x00,

/*--  文字:  E  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x48,0x50,0x70,0x50,0x40,0x48,0xF8,0x00,0x00,

/*--  文字:  F  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x48,0x50,0x70,0x50,0x40,0x40,0xE0,0x00,0x00,

/*--  文字:  G  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x38,0x48,0x80,0x80,0x9C,0x88,0x48,0x30,0x00,0x00,

/*--  文字:  H  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xCC,0x48,0x48,0x78,0x48,0x48,0x48,0xCC,0x00,0x00,

/*--  文字:  I  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x20,0x20,0x20,0x20,0x20,0x20,0xF8,0x00,0x00,

/*--  文字:  J  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x90,0xE0,0x00,

/*--  文字:  K  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xEC,0x48,0x50,0x60,0x50,0x50,0x48,0xEC,0x00,0x00,

/*--  文字:  L  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xE0,0x40,0x40,0x40,0x40,0x40,0x44,0xFC,0x00,0x00,

/*--  文字:  M  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xD8,0xD8,0xD8,0xD8,0xA8,0xA8,0xA8,0xA8,0x00,0x00,

/*--  文字:  N  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xDC,0x48,0x68,0x68,0x58,0x58,0x48,0xE8,0x00,0x00,

/*--  文字:  O  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x88,0x88,0x88,0x88,0x70,0x00,0x00,

/*--  文字:  P  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF0,0x48,0x48,0x70,0x40,0x40,0x40,0xE0,0x00,0x00,

/*--  文字:  Q  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x70,0x88,0x88,0x88,0x88,0xE8,0x98,0x70,0x18,0x00,

/*--  文字:  R  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF0,0x48,0x48,0x70,0x50,0x48,0x48,0xEC,0x00,0x00,

/*--  文字:  S  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x78,0x88,0x80,0x60,0x10,0x08,0x88,0xF0,0x00,0x00,

/*--  文字:  T  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0xA8,0x20,0x20,0x20,0x20,0x20,0x70,0x00,0x00,

/*--  文字:  U  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xCC,0x48,0x48,0x48,0x48,0x48,0x48,0x30,0x00,0x00,

/*--  文字:  V  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xCC,0x48,0x48,0x50,0x50,0x30,0x20,0x20,0x00,0x00,

/*--  文字:  W  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xA8,0xA8,0xA8,0x70,0x50,0x50,0x50,0x50,0x00,0x00,

/*--  文字:  X  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x50,0x50,0xD8,0x00,0x00,

/*--  文字:  Y  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xD8,0x50,0x50,0x20,0x20,0x20,0x20,0x70,0x00,0x00,

/*--  文字:  Z  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xF8,0x90,0x10,0x20,0x20,0x40,0x48,0xF8,0x00,0x00,

/*--  文字:  [  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x38,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x38,0x00,

/*--  文字:  \  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x40,0x40,0x40,0x20,0x20,0x10,0x10,0x10,0x08,0x00,0x00,

/*--  文字:  ]  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x70,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x70,0x00,

/*--  文字:  ^  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x20,0x50,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  _  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,

/*--  文字:  `  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  a  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x38,0x48,0x3C,0x00,0x00,

/*--  文字:  b  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xC0,0x40,0x40,0x70,0x48,0x48,0x48,0x70,0x00,0x00,

/*--  文字:  c  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x38,0x48,0x40,0x40,0x38,0x00,0x00,

/*--  文字:  d  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x18,0x08,0x08,0x38,0x48,0x48,0x48,0x3C,0x00,0x00,

/*--  文字:  e  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x78,0x40,0x38,0x00,0x00,

/*--  文字:  f  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x1C,0x20,0x20,0x78,0x20,0x20,0x20,0x78,0x00,0x00,

/*--  文字:  g  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x3C,0x48,0x30,0x40,0x78,0x44,0x38,

/*--  文字:  h  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xC0,0x40,0x40,0x70,0x48,0x48,0x48,0xEC,0x00,0x00,

/*--  文字:  i  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x20,0x00,0x00,0x60,0x20,0x20,0x20,0x70,0x00,0x00,

/*--  文字:  j  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x10,0x00,0x00,0x30,0x10,0x10,0x10,0x10,0x10,0xE0,

/*--  文字:  k  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xC0,0x40,0x40,0x5C,0x50,0x70,0x48,0xEC,0x00,0x00,

/*--  文字:  l  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0xE0,0x20,0x20,0x20,0x20,0x20,0x20,0xF8,0x00,0x00,

/*--  文字:  m  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xF0,0xA8,0xA8,0xA8,0xA8,0x00,0x00,

/*--  文字:  n  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xF0,0x48,0x48,0x48,0xEC,0x00,0x00,

/*--  文字:  o  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x30,0x48,0x48,0x48,0x30,0x00,0x00,

/*--  文字:  p  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xF0,0x48,0x48,0x48,0x70,0x40,0xE0,

/*--  文字:  q  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x38,0x48,0x48,0x48,0x38,0x08,0x1C,

/*--  文字:  r  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xD8,0x60,0x40,0x40,0xE0,0x00,0x00,

/*--  文字:  s  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x78,0x40,0x30,0x08,0x78,0x00,0x00,

/*--  文字:  t  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x20,0x20,0x70,0x20,0x20,0x20,0x18,0x00,0x00,

/*--  文字:  u  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xD8,0x48,0x48,0x48,0x3C,0x00,0x00,

/*--  文字:  v  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xEC,0x48,0x50,0x30,0x20,0x00,0x00,

/*--  文字:  w  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xA8,0xA8,0x70,0x50,0x50,0x00,0x00,

/*--  文字:  x  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xD8,0x50,0x20,0x50,0xD8,0x00,0x00,

/*--  文字:  y  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0xEC,0x48,0x50,0x30,0x20,0x20,0xC0,

/*--  文字:  z  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x00,0x00,0x00,0x00,0x78,0x10,0x20,0x20,0x78,0x00,0x00,

/*--  文字:  {  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x18,0x10,0x10,0x10,0x20,0x10,0x10,0x10,0x10,0x18,0x00,

/*--  文字:  |  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,

/*--  文字:  }  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x00,0x60,0x20,0x20,0x20,0x10,0x20,0x20,0x20,0x20,0x60,0x00,

/*--  文字:  ~  --*/
/*--  宋体9;  此字体下对应的点阵为：宽x高=6x12   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=8x12  --*/
0x40,0xA4,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

    
};  

//**********************************************************
void spistar()                                     //SPI开始
{
CS=1;
DCLK=1;
DIN=1;
DCLK=1;
}
//**********************************************************
void WriteCharTo7843(unsigned char num)          //SPI写数据
{
unsigned char count=0;
DCLK=0;
for(count=0;count<8;count++)
{
num<<=1;
DIN=CY;
DCLK=0; _nop_();_nop_();_nop_();                //上升沿有效
DCLK=1; _nop_();_nop_();_nop_();
}
}
//**********************************************************
unsigned int ReadFromCharFrom7843()             //SPI 读数据
{
unsigned char count=0;
unsigned int Num=0;
for(count=0;count<12;count++)
{
Num<<=1;
DCLK=1; _nop_();_nop_();_nop_();                //下降沿有效
DCLK=0; _nop_();_nop_();_nop_();
if(DOUT) Num++;
}
return(Num);
}	
void delayms(int count)  // /* X1ms */
{
        int i,j;
        for(i=0;i<count;i++)
                for(j=0;j<1000;j++);
}

#ifdef  Bus_16    //条件编译-16位数据模式   
void LCD_Writ_Bus(char VH,char VL)   //并行数据写入函数
{
    LCD_DataPortH=VH;	
	LCD_DataPortL=VL;		
	LCD_WR=0;
	LCD_WR=1; 
}
#else			//条件编译-8位数据模式 
void LCD_Writ_Bus(char VH,char VL)   //并行数据写入函数
{	
    LCD_DataPortH=VH;	
   	LCD_WR=0;
	LCD_WR=1;
	LCD_DataPortH=VL;		
	LCD_WR=0;
	LCD_WR=1;
}
#endif

void Lcd_Write_Com(char VH,char VL)	 //发送命令-8位参数
{	
    LCD_RS=0;
	LCD_Writ_Bus(VH,VL);
}
void Lcd_Write_Data(char VH,char VL) //发送数据-8位参数
{
    LCD_RS=1;
	LCD_Writ_Bus(VH,VL);
}
void Lcd_Write_Com_Data(int com,int val)		   //发送数据命令
{
	Lcd_Write_Com(com>>8,com);
    Lcd_Write_Data(val>>8,val);
}

void Address_set(unsigned int x1,unsigned int y1,unsigned int x2,unsigned int y2)
{
	Lcd_Write_Com(0x00,0x20);Lcd_Write_Data(x1>>8,x1);	  //设置X坐标位置
    Lcd_Write_Com(0x00,0x21);Lcd_Write_Data(y1>>8,y1);   //设置Y坐标位置
    Lcd_Write_Com(0x00,0x50);Lcd_Write_Data(x1>>8,x1);   //开始X
	Lcd_Write_Com(0x00,0x52);Lcd_Write_Data(y1>>8,y1);	  //开始Y
    Lcd_Write_Com(0x00,0x51);Lcd_Write_Data(x2>>8,x2);   //结束X
	Lcd_Write_Com(0x00,0x53);Lcd_Write_Data(y2>>8,y2);   //结束Y
    Lcd_Write_Com(0x00,0x22);							 
}
void Lcd_Init(void)
{

    LCD_REST=1;
    delayms(5);	
	LCD_REST=0;
	delayms(5);
	LCD_REST=1;
	LCD_CS=1;
	LCD_RD=1;
	LCD_WR=1;
	delayms(5);
	

	LCD_CS =0;  //打开片选使能
	//************* Start Initial Sequence **********//

 Lcd_Write_Com_Data(0x00e5, 0x8000);	
		Lcd_Write_Com_Data(0x0000, 0x0001);	
		Lcd_Write_Com_Data(0x0001, 0x0100);
		Lcd_Write_Com_Data(0x0002, 0x0700);
		Lcd_Write_Com_Data(0x0003, 0x1030);
		Lcd_Write_Com_Data(0x0004, 0x0000);
		Lcd_Write_Com_Data(0x0008, 0x0202);	
		Lcd_Write_Com_Data(0x0009, 0x0000);	
		Lcd_Write_Com_Data(0x000A, 0x0000);
		Lcd_Write_Com_Data(0x000C, 0x0000);	
		Lcd_Write_Com_Data(0x000D, 0x0000);	
		Lcd_Write_Com_Data(0x000F, 0x0000);	
	//-----Power On sequence-----------------------	
		Lcd_Write_Com_Data(0x0010, 0x0000);	
		Lcd_Write_Com_Data(0x0011, 0x0007);	
		Lcd_Write_Com_Data(0x0012, 0x0000);	
		Lcd_Write_Com_Data(0x0013, 0x0000);	
		delayms(150);
		Lcd_Write_Com_Data(0x0010, 0x17B0);	
		Lcd_Write_Com_Data(0x0011, 0x0007);	
		delayms(50);
		Lcd_Write_Com_Data(0x0012, 0x013A);	
		delayms(50);
		Lcd_Write_Com_Data(0x0013, 0x1A00);	
		Lcd_Write_Com_Data(0x0029, 0x000c);		
		delayms(50);
	//-----Gamma control-----------------------	
		Lcd_Write_Com_Data(0x0030, 0x0000);	
		Lcd_Write_Com_Data(0x0031, 0x0505);	
		Lcd_Write_Com_Data(0x0032, 0x0004);	
		Lcd_Write_Com_Data(0x0035, 0x0006);	
		Lcd_Write_Com_Data(0x0036, 0x0707);	
		Lcd_Write_Com_Data(0x0037, 0x0105);	
		Lcd_Write_Com_Data(0x0038, 0x0002);	
		Lcd_Write_Com_Data(0x0039, 0x0707);	
		Lcd_Write_Com_Data(0x003C, 0x0704);	
		Lcd_Write_Com_Data(0x003D, 0x0807);	
	//-----Set RAM area-----------------------	
		Lcd_Write_Com_Data(0x0050, 0x0000);
		Lcd_Write_Com_Data(0x0051, 0x00EF);
		Lcd_Write_Com_Data(0x0052, 0x0000);
		Lcd_Write_Com_Data(0x0053, 0x013F);
		Lcd_Write_Com_Data(0x0060, 0x2700);
		Lcd_Write_Com_Data(0x0061, 0x0001);
		Lcd_Write_Com_Data(0x006A, 0x0000);
		Lcd_Write_Com_Data(0x0021, 0x0000);	
		Lcd_Write_Com_Data(0x0020, 0x0000);	
	//-----Partial Display Control------------	
		Lcd_Write_Com_Data(0x0080, 0x0000);	
		Lcd_Write_Com_Data(0x0081, 0x0000);
		Lcd_Write_Com_Data(0x0082, 0x0000);
		Lcd_Write_Com_Data(0x0083, 0x0000);
		Lcd_Write_Com_Data(0x0084, 0x0000);	
		Lcd_Write_Com_Data(0x0085, 0x0000);
	//-----Panel Control----------------------
		Lcd_Write_Com_Data(0x0090, 0x0010);	
		Lcd_Write_Com_Data(0x0092, 0x0000);
		Lcd_Write_Com_Data(0x0093, 0x0003);
		Lcd_Write_Com_Data(0x0095, 0x0110);
		Lcd_Write_Com_Data(0x0097, 0x0000);	
		Lcd_Write_Com_Data(0x0098, 0x0000);
	//-----Display on-----------------------	
		Lcd_Write_Com_Data(0x0007, 0x0173);	
		delayms(50);

	LCD_CS =1;  //关闭片选使能

}		 
void Pant(char VH,char VL)
{
	int i,j;
	LCD_CS =0;  //打开片选使能
	Address_set(0,0,239,319);
    for(i=0;i<320;i++)
	 {
	  for (j=0;j<240;j++)
	   	{
        	 Lcd_Write_Data(VH,VL);
	    }

	  }
     LCD_CS =1;  //关闭片选使能
}
void inttostr(int dd,unsigned char *str)
{
	str[0]=dd/10000+48;
	str[1]=(dd/1000)-((dd/10000)*10)+48;
	str[2]=(dd/100)-((dd/1000)*10)+48;
	str[3]=(dd/10)-((dd/100)*10)+48;
	str[4]=dd-((dd/10)*10)+48;
	str[5]=0;
} 
unsigned char Makpix(struct pix_ pix1,struct pix_ pix2)
{
unsigned char l=0;
int x=pix1.x>pix2.x?pix1.x-pix2.x:pix2.x-pix1.x;
int y=pix1.y>pix2.y?pix1.y-pix2.y:pix2.y-pix1.y;
if(x<14&&y<11)	 //软件滤波，2次取样的值相差太大的视为噪声
{
	l=1;
	Tp_pix.x=pix1.x;
	Tp_pix.y=pix1.y;
}
return l;
}
struct pix_ AD7843()            
{
//delayms(1);                     //中断后延时以消除抖动，使得采样数据更准确
//spistar();                       //启动SPI
//while(BUSY);                //如果BUSY信号不好使可以删除不用
//delayms(1);
struct pix_ pix;
CS=0;
WriteCharTo7843(0x90);        //送控制字 10010000 即用差分方式读X坐标 详细请见有关资料
//while(BUSY);               //如果BUSY信号不好使可以删除不用
//delayms(1);
DCLK=1; _nop_();_nop_();_nop_();_nop_();
DCLK=0; _nop_();_nop_();_nop_();_nop_();
pix.y=ReadFromCharFrom7843();
WriteCharTo7843(0xD0);       //送控制字 11010000 即用差分方式读Y坐标 详细请见有关资料
DCLK=1; _nop_();_nop_();_nop_();_nop_();
DCLK=0; _nop_();_nop_();_nop_();_nop_();
pix.x=ReadFromCharFrom7843();
CS=1; 
return pix;
}
unsigned char Getpix() //取采样值，此处使用软件滤波，2次取样的值相差太大的视为噪声
{
	struct pix_ pix1;
	struct pix_ pix2; 
	pix1=AD7843();
	pix2=AD7843();
 	return	Makpix(pix1,pix2);	
}

//在指定位置显示一个字符(8*12大小)
//dcolor为内容颜色，gbcolor为背静颜色
void showzifu(unsigned int x,unsigned int y,unsigned char value,unsigned int dcolor,unsigned int bgcolor)	
{  
	unsigned char i,j;
	unsigned char *temp=zifu;    
    Address_set(x,y,x+7,y+11); //设置区域      
	temp+=(value-32)*12;
	for(j=0;j<12;j++)
	{
		for(i=0;i<8;i++)
		{ 		     
		 	if((*temp&(1<<(7-i)))!=0)
			{
				Lcd_Write_Data(dcolor>>8,dcolor);
			} 
			else
			{
				Lcd_Write_Data(bgcolor>>8,bgcolor);
			}   
		}
		temp++;
	 }
}

//在指定位置显示一个字符串(8*12大小)
//dcolor为内容颜色，gbcolor为背静颜色
void showzifustr(unsigned int x,unsigned int y,unsigned char *str,unsigned int dcolor,unsigned int bgcolor)	  
{  
	unsigned int x1,y1;
	x1=x;
	y1=y;
	while(*str!='\0')
	{	
		showzifu(x1,y1,*str,dcolor,bgcolor);
		x1+=7;
		str++;
	}	
}

main()
{
	unsigned char ss[6];	
	unsigned int lx,ly;	
	spistar();  //模拟spi初始化
	Lcd_Init();   //tft初始化
 	Pant(0xff,0xff);	//清屏					
	LCD_CS =0;  //打开LCD片选使能
    showzifustr(68,5,"GOOD",0,0xffff);	//显示字符串   
	while(1)
	{	
		if (Penirq==0)
		{  		
			if(Getpix()==1) //得到当前TP的取样值，此处使用软件滤波，2次取样的值相差太大的视为噪声
			{
				inttostr(Tp_pix.x,ss);
				showzifustr(10,305,"X:",0xf800,0xffff);
				showzifustr(25,305,ss,0xf800,0xffff);	//显示字符串 
				inttostr(Tp_pix.y,ss);
				showzifustr(80,305,"Y:",0xf800,0xffff);
				showzifustr(95,305,ss,0xf800,0xffff);	//显示字符串 
				lx=240-((Tp_pix.x-320)*10/146);
				ly=320-((Tp_pix.y-380)/11);
				Address_set(lx,ly,lx+2,ly+2);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
				Lcd_Write_Data(0,255);
			}
		//	delayms(100);

		}
		else
		{

		}

    }



}













